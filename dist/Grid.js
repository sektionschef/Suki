class Grid{constructor(t){if(this.stripeOrientation=t.stripeOrientation,this.thickness=t.thickness,this.spacing=t.spacing,this.countColumnOrRow=t.countColumnOrRow,this.bezierFactor=t.bezierFactor,this.pattern=t.pattern.buffer,this.pattern2=t.pattern2.buffer,this.backgroundNoise=t.backgroundNoise,"last"==t.whichLoopLevel?this.whichLoopLevel=1:"secondlast"==t.whichLoopLevel?this.whichLoopLevel=2:this.whichLoopLevel=3,this.DEBUG=!1,this.paperMargin=.05*SHORTSIDE,this.sizeStripeMin=15,this.paddingHeightCountMin=5,this.paddingHeightCountMax=5,this.paddingWidthCountMin=5,this.paddingWidthCountMax=5,this.shortBoxCount=80,this.boxSize=SHORTSIDE/this.shortBoxCount,this.longBoxCount=Math.floor(LONGSIDE/this.boxSize),this.bezierOffset=this.bezierFactor*SHORTSIDE,this.shortMargin=SHORTSIDE%this.boxSize,0!=this.shortMargin)throw new Error("wtf, there is a margin!");this.longMargin=LONGSIDE%this.boxSize/2,width<height?(this.widthBoxCount=this.shortBoxCount,this.heightBoxCount=this.longBoxCount,this.widthMargin=this.shortMargin,this.heightMargin=this.longMargin):(this.widthBoxCount=this.longBoxCount,this.heightBoxCount=this.shortBoxCount,this.widthMargin=this.longMargin,this.heightMargin=this.shortMargin),this.sizeStripe=Math.floor(getRandomFromInterval(this.sizeStripeMin,this.shortBoxCount/this.countColumnOrRow-this.sizeStripeMin)),this.columns=new Set,this.rows=new Set,this.boxes=[],this.stripes=[],this.stripeLines=[],this.buffer=createGraphics(width,height),this.bufferNoise=createGraphics(width,height),this.totalA=createVector(this.buffer.width/2,this.buffer.height/2),this.totalC=createVector(this.buffer.width/2,this.buffer.height/2),this.createBoxes(),this.createMask(),this.createComplexBase(),this.drawNoise(),this.drawMask()}createBoxes(){for(var t=0,e=0;e<this.heightBoxCount;e++)for(var o=0;o<this.widthBoxCount;o++){var i=createVector(this.widthMargin+o*this.boxSize,this.heightMargin+e*this.boxSize),r=p5.Vector.add(i,createVector(this.boxSize,0)),s=p5.Vector.add(i,createVector(this.boxSize,this.boxSize)),h=p5.Vector.add(i,createVector(0,this.boxSize)),n=createVector(r.x+(i.x-r.x)/4,r.y+getRandomFromInterval(-this.bezierOffset,this.bezierOffset)),a=createVector(r.x+(i.x-r.x)/4*3,r.y+getRandomFromInterval(-this.bezierOffset,this.bezierOffset)),p=createVector(s.x+getRandomFromInterval(-this.bezierOffset,this.bezierOffset),s.y+(r.y-s.y)/4),l=createVector(s.x+getRandomFromInterval(-this.bezierOffset,this.bezierOffset),s.y+(r.y-s.y)/4*3),f=createVector(h.x+(s.x-h.x)/4*3,h.y+getRandomFromInterval(-this.bezierOffset,this.bezierOffset)),d=createVector(h.x+(s.x-h.x)/4,h.y+getRandomFromInterval(-this.bezierOffset,this.bezierOffset)),g=createVector(i.x+getRandomFromInterval(-this.bezierOffset,this.bezierOffset),i.y+(h.y-i.y)/4*3),c=createVector(i.x+getRandomFromInterval(-this.bezierOffset,this.bezierOffset),i.y+(h.y-i.y)/4);this.boxes.push({A:i,B:r,C:s,D:h,ABStop1:n,ABStop2:a,BCStop1:p,BCStop2:l,CDStop1:f,CDStop2:d,DAStop1:g,DAStop2:c,long:e,short:o,index:t,mask:!1}),t+=1}}showDebug(){for(var t=0;t<this.boxes.length;t++)this.buffer.push(),this.buffer.fill(255*random(),20),this.buffer.noStroke(),this.buffer.rectMode(CORNERS),this.buffer.rect(this.boxes[t].A.x,this.boxes[t].A.y,this.boxes[t].C.x,this.boxes[t].C.y),this.buffer.pop()}createMask(){if(this.DEBUG&&(console.log("stripeOrientation: "+this.stripeOrientation),console.log("widthBoxCount: "+this.widthBoxCount),console.log("heightBoxCount: "+this.heightBoxCount),console.log("shortBoxCount: "+this.shortBoxCount),console.log("longBoxCount: "+this.longBoxCount),console.log("countColumnOrRow: "+this.countColumnOrRow),console.log("sizeStripe: "+this.sizeStripe),console.log("thickness: "+this.thickness),console.log("spacing: "+this.spacing)),"x"==this.stripeOrientation){this.Gap=this.widthBoxCount-this.sizeStripe*this.countColumnOrRow,1!=this.countColumnOrRow?(this.possibleColumnGap=this.Gap/(this.countColumnOrRow-1),this.columnGap=Math.floor(getRandomFromInterval(this.possibleColumnGap/6,this.possibleColumnGap/4)),this.paddingWidthCount=Math.floor((this.Gap-this.columnGap*(this.countColumnOrRow-1))/2)):(this.columnGap=0,this.paddingWidthCount=Math.floor(this.Gap/2)),this.paddingHeightCount=Math.floor(getRandomFromInterval(this.longBoxCount/this.paddingHeightCountMin,this.longBoxCount/this.paddingHeightCountMax)),this.DEBUG&&(console.log("gap: "+this.Gap),console.log("columnGap: "+this.columnGap),console.log("paddingWidthCount: "+this.paddingWidthCount),console.log("paddingHeightCount: "+this.paddingHeightCount));for(var t=this.paddingHeightCount*this.widthBoxCount+this.paddingWidthCount;t<this.heightBoxCount*this.widthBoxCount-this.paddingHeightCount*this.widthBoxCount;t+=this.widthBoxCount*this.thickness*this.spacing)for(var e=0;e<this.countColumnOrRow;e++){let o=t+this.sizeStripe*e+this.columnGap*e,i=o+this.sizeStripe,r=i+(this.thickness-1)*this.widthBoxCount,s=o+(this.thickness-1)*this.widthBoxCount;this.writeToStripes(o,i,r,s)}}else for(this.Gap=this.heightBoxCount-this.sizeStripe*this.countColumnOrRow,1!=this.countColumnOrRow?(this.possibleRowGap=Math.floor(this.Gap/(this.countColumnOrRow-1)),this.rowGap=Math.floor(getRandomFromInterval(this.possibleRowGap/6,this.possibleRowGap/4)),this.paddingHeightCount=Math.floor((this.Gap-this.rowGap*(this.countColumnOrRow-1))/2)):(this.rowGap=0,this.paddingHeightCount=Math.floor(this.Gap/2)),this.paddingWidthCount=Math.floor(getRandomFromInterval(this.widthBoxCount/this.paddingWidthCountMin,this.widthBoxCount/this.paddingWidthCountMax)),this.DEBUG&&(console.log("gap: "+this.Gap),console.log("rowGap: "+this.rowGap),console.log("paddingWidthCount: "+this.paddingWidthCount),console.log("paddingHeightCount: "+this.paddingHeightCount)),e=this.paddingWidthCount;e<this.widthBoxCount-this.paddingWidthCount;e+=this.thickness+this.spacing)for(t=0;t<this.countColumnOrRow;t++){let o=e+this.paddingHeightCount*this.widthBoxCount+this.sizeStripe*t*this.widthBoxCount+this.rowGap*t*this.widthBoxCount,i=o+(this.thickness-1),r=o+this.sizeStripe*this.widthBoxCount,s=r+(this.thickness-1);this.writeToStripes(o,i,s,r)}}writeToStripes(t,e,o,i){this.A=this.boxes[t].A,this.B=this.boxes[e].B,this.C=this.boxes[o].C,this.D=this.boxes[i].D,this.stripes.push({A:this.A,B:this.B,C:this.C,D:this.D,ABStop1:createVector(this.A.x+(this.B.x-this.A.x)/4,this.A.y+getRandomFromInterval(-this.bezierOffset,this.bezierOffset)),ABStop2:createVector(this.A.x+(this.B.x-this.A.x)/4*3,this.A.y+getRandomFromInterval(-this.bezierOffset,this.bezierOffset)),BCStop1:createVector(this.C.x+getRandomFromInterval(-this.bezierOffset,this.bezierOffset),this.C.y+(this.B.y-this.C.y)/4),BCStop2:createVector(this.C.x+getRandomFromInterval(-this.bezierOffset,this.bezierOffset),this.C.y+(this.B.y-this.C.y)/4*3),CDStop1:createVector(this.D.x+(this.C.x-this.D.x)/4,this.D.y+getRandomFromInterval(-this.bezierOffset,this.bezierOffset)),CDStop2:createVector(this.D.x+(this.C.x-this.D.x)/4*3,this.D.y+getRandomFromInterval(-this.bezierOffset,this.bezierOffset)),DAStop2:createVector(this.A.x+getRandomFromInterval(-this.bezierOffset,this.bezierOffset),this.A.y+(this.D.y-this.A.y)/4),DAStop1:createVector(this.A.x+getRandomFromInterval(-this.bezierOffset,this.bezierOffset),this.A.y+(this.D.y-this.A.y)/4*3)}),this.A.x<this.totalA.x&&this.A.y<this.totalA.y&&(this.totalA=this.A),this.C.x>=this.totalC.x&&this.C.y>=this.totalC.y&&(this.totalC=this.C)}drawMask(){this.buffer.push(),this.buffer.image(this.complexBaseBuffer,0,0),this.buffer.pop()}createComplexBase(){this.complexBaseBuffer=createGraphics(width,height);let t=30;this.loopLayerCount=20;let e=.05*SHORTSIDE,o=color(red(PALETTE.cardboard),green(PALETTE.cardboard),blue(PALETTE.cardboard),20);for(var i=0;i<this.loopLayerCount;i++){this.loopBuffer=createGraphics(width,height),this.loopBuffer.push(),this.loopBuffer.fill(distortColorSuperNew(o,30)),this.loopBuffer.noStroke(),this.loopBuffer.beginShape();let r=createVector(e+getRandomFromInterval(-30,t),e+getRandomFromInterval(-30,t)),s=createVector(width/9*2+getRandomFromInterval(-30,t),e+getRandomFromInterval(-30,t)),h=createVector(width/9*4+getRandomFromInterval(-30,t),e+getRandomFromInterval(-30,t)),n=createVector(width/9*5+getRandomFromInterval(-30,t),e+getRandomFromInterval(-30,t)),a=createVector(width/9*7+getRandomFromInterval(-30,t),e+getRandomFromInterval(-30,t)),p=createVector(width/9*8+getRandomFromInterval(-30,t),e+getRandomFromInterval(-30,t)),l=createVector(width-e+getRandomFromInterval(-30,t),e+getRandomFromInterval(-30,t)),f=createVector(width-e+getRandomFromInterval(-30,t),height/9*2+getRandomFromInterval(-30,t)),d=createVector(width-e+getRandomFromInterval(-30,t),height/9*3+getRandomFromInterval(-30,t)),g=createVector(width-e+getRandomFromInterval(-30,t),height/9*5+getRandomFromInterval(-30,t)),c=createVector(width-e+getRandomFromInterval(-30,t),height/9*6+getRandomFromInterval(-30,t)),u=createVector(width-e+getRandomFromInterval(-30,t),height/9*7+getRandomFromInterval(-30,t)),m=createVector(width-e+getRandomFromInterval(-30,t),height-e+getRandomFromInterval(-30,t)),x=createVector(width/9*8+getRandomFromInterval(-30,t),height-e+getRandomFromInterval(-30,t)),B=createVector(width/9*7+getRandomFromInterval(-30,t),height-e+getRandomFromInterval(-30,t)),C=createVector(width/9*5+getRandomFromInterval(-30,t),height-e+getRandomFromInterval(-30,t)),b=createVector(width/9*4+getRandomFromInterval(-30,t),height-e+getRandomFromInterval(-30,t)),R=createVector(width/9*2+getRandomFromInterval(-30,t),height-e+getRandomFromInterval(-30,t)),S=createVector(e+getRandomFromInterval(-30,t),height-e+getRandomFromInterval(-30,t)),w=createVector(e+getRandomFromInterval(-30,t),height/9*2+getRandomFromInterval(-30,t)),v=createVector(e+getRandomFromInterval(-30,t),height/9*3+getRandomFromInterval(-30,t)),I=createVector(e+getRandomFromInterval(-30,t),height/9*5+getRandomFromInterval(-30,t)),F=createVector(e+getRandomFromInterval(-30,t),height/9*6+getRandomFromInterval(-30,t)),y=createVector(e+getRandomFromInterval(-30,t),height/9*7+getRandomFromInterval(-30,t));this.loopBuffer.vertex(r.x,r.y),this.loopBuffer.bezierVertex(s.x,s.y,h.x,h.y,n.x,n.y),this.loopBuffer.bezierVertex(a.x,a.y,p.x,p.y,l.x,l.y),this.loopBuffer.bezierVertex(f.x,f.y,d.x,d.y,g.x,g.y),this.loopBuffer.bezierVertex(c.x,c.y,u.x,u.y,m.x,m.y),this.loopBuffer.bezierVertex(x.x,x.y,B.x,B.y,C.x,C.y),this.loopBuffer.bezierVertex(b.x,b.y,R.x,R.y,S.x,S.y),this.loopBuffer.bezierVertex(w.x,w.y,v.x,v.y,I.x,I.y),this.loopBuffer.bezierVertex(F.x,F.y,y.x,y.y,r.x,r.y),this.createMaskContour(),this.loopBuffer.endShape(CLOSE),this.loopBuffer.pop(),i%3==0&&(this.loopBuffer.push(),this.loopBuffer.blendMode(OVERLAY),this.loopBuffer.image(maskBuffers(this.backgroundNoise.masterBuffer,this.loopBuffer),0,0),this.loopBuffer.pop()),i==this.loopLayerCount-this.whichLoopLevel&&(this.loopBuffer.push(),this.loopBuffer.image(maskBuffers(this.pattern2,this.loopBuffer),0,0),this.loopBuffer.image(maskBuffers(this.pattern,this.loopBuffer),0,0),this.loopBuffer.pop()),this.complexBaseBuffer.image(this.loopBuffer,0,0)}}createMaskContour(){let t=10;for(var e=0;e<this.stripes.length;e++){let o=this.stripes[e];this.stripes[e+2],this.A=p5.Vector.add(o.A,createVector(getRandomFromInterval(-10,t),getRandomFromInterval(-10,t))),this.B=p5.Vector.add(o.B,createVector(getRandomFromInterval(-10,t),getRandomFromInterval(-10,t))),this.C=p5.Vector.add(o.C,createVector(getRandomFromInterval(-10,t),getRandomFromInterval(-10,t))),this.D=p5.Vector.add(o.D,createVector(getRandomFromInterval(-10,t),getRandomFromInterval(-10,t))),this.ABStop1=p5.Vector.add(o.ABStop1,createVector(getRandomFromInterval(-10,t),getRandomFromInterval(-10,t))),this.ABStop2=p5.Vector.add(o.ABStop2,createVector(getRandomFromInterval(-10,t),getRandomFromInterval(-10,t))),this.BCStop1=p5.Vector.add(o.BCStop1,createVector(getRandomFromInterval(-10,t),getRandomFromInterval(-10,t))),this.BCStop2=p5.Vector.add(o.BCStop2,createVector(getRandomFromInterval(-10,t),getRandomFromInterval(-10,t))),this.CDStop1=p5.Vector.add(o.CDStop1,createVector(getRandomFromInterval(-10,t),getRandomFromInterval(-10,t))),this.CDStop2=p5.Vector.add(o.CDStop2,createVector(getRandomFromInterval(-10,t),getRandomFromInterval(-10,t))),this.DAStop2=p5.Vector.add(o.DAStop2,createVector(getRandomFromInterval(-10,t),getRandomFromInterval(-10,t))),this.DAStop1=p5.Vector.add(o.DAStop1,createVector(getRandomFromInterval(-10,t),getRandomFromInterval(-10,t))),this.stripeLines.push({A:this.A,B:this.B,C:this.C,D:this.D,ABStop1:this.ABStop1,ABStop2:this.ABStop2,BCStop1:this.BCStop1,BCStop2:this.BCStop2,CDStop1:this.CDStop1,CDStop2:this.CDStop2,DAStop2:this.DAStop2,DAStop1:this.DAStop1}),this.loopBuffer.beginContour(),this.loopBuffer.vertex(this.A.x,this.A.y),this.loopBuffer.bezierVertex(this.DAStop2.x,this.DAStop2.y,this.DAStop1.x,this.DAStop1.y,this.D.x,this.D.y),this.loopBuffer.bezierVertex(this.CDStop2.x,this.CDStop2.y,this.CDStop1.x,this.CDStop1.y,this.C.x,this.C.y),this.loopBuffer.bezierVertex(this.BCStop2.x,this.BCStop2.y,this.BCStop1.x,this.BCStop1.y,this.B.x,this.B.y),this.loopBuffer.bezierVertex(this.ABStop2.x,this.ABStop2.y,this.ABStop1.x,this.ABStop1.y,this.A.x,this.A.y),this.loopBuffer.endContour(),this.createNoise(this.A,this.ABStop1,this.ABStop2,this.B)}}createNoise(t,e,o,i){this.noiseWeight=1,this.noiseColor=color("#b1b1b1"),this.pointCount=.2*p5.Vector.dist(t,i),this.noiseDistance=1;for(var r=0;r<this.pointCount;r++){let r=getRandomFromInterval(t.x,i.x),s=randomGaussian(0,this.noiseDistance),h=map(r,t.x,i.x,0,1);this.baseY=bezierPoint(t.y,e.y,o.y,i.y,h);let n=this.baseY+abs(s);this.bufferNoise.push(),this.bufferNoise.stroke(this.noiseColor),this.bufferNoise.strokeWeight(this.noiseWeight),this.bufferNoise.point(r,n),this.bufferNoise.pop()}}createUpperLine(){this.lowerUpperBuffer=createGraphics(width,height);for(var t=0;t<this.stripeLines.length;t++)if(t>this.stripeLines.length-3*this.stripes.length){let e=this.stripeLines[t].A,o=this.stripeLines[t].ABStop1,i=this.stripeLines[t].ABStop2,r=this.stripeLines[t].B;this.lowerUpperBuffer.push(),this.lowerUpperBuffer.stroke(color("#7c7c7c7e")),this.lowerUpperBuffer.strokeWeight(1),this.lowerUpperBuffer.noFill(),this.lowerUpperBuffer.beginShape(),this.lowerUpperBuffer.vertex(e.x,e.y),this.lowerUpperBuffer.bezierVertex(o.x,o.y,i.x,i.y,r.x,r.y),this.lowerUpperBuffer.endShape(),this.lowerUpperBuffer.pop()}this.buffer.push(),this.buffer.blendMode(OVERLAY),this.buffer.image(this.lowerUpperBuffer,0,0),this.buffer.pop()}createLowerLine(){this.lowerLineBuffer=createGraphics(width,height);for(var t=0;t<this.stripeLines.length;t++)if(t>this.stripeLines.length-3*this.stripes.length){let e=this.stripeLines[t].C,o=this.stripeLines[t].CDStop1,i=this.stripeLines[t].CDStop2,r=this.stripeLines[t].D;this.lowerLineBuffer.push(),this.lowerLineBuffer.stroke(color("#eeeeee63")),this.lowerLineBuffer.strokeWeight(1),this.lowerLineBuffer.noFill(),this.lowerLineBuffer.beginShape(),this.lowerLineBuffer.vertex(e.x,e.y),this.lowerLineBuffer.bezierVertex(o.x,o.y,i.x,i.y,r.x,r.y),this.lowerLineBuffer.endShape(),this.lowerLineBuffer.pop()}this.buffer.push(),this.buffer.image(this.lowerLineBuffer,0,0),this.buffer.pop()}drawNoise(){this.buffer.push(),this.buffer.image(this.bufferNoise,0,0),this.buffer.pop()}show(){push(),image(this.buffer,0,0),pop()}}